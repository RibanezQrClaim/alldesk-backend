<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Bandeja de Entrada - AllDesk.ai</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 12px; text-align: left; vertical-align: top; }
        th { background-color: #f0f0f0; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }

        .urgente { color: red; font-weight: bold; }
        .neutral { color: gray; }
        .positivo { color: green; }
        .negativo { color: darkred; }

        .urgencia-1 { background-color: #d4edda; }    /* verde claro */
        .urgencia-2 { background-color: #fff3cd; }    /* amarillo */
        .urgencia-3 { background-color: #ffeeba; }    /* naranjo */
        .urgencia-4, .urgencia-5 { background-color: #f8d7da; font-weight: bold; }  /* rojo claro */

        .prioridad-baja { color: gray; }
        .prioridad-normal { color: #007bff; }
        .prioridad-alta { color: #d39e00; }
        .prioridad-critica { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Bandeja de Entrada de Tickets</h1>

    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('crear_ticket') }}" style="padding: 10px 15px; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px;">
            + Crear Nuevo Ticket
        </a>
    </div>

    <table>
        <thead>
            <tr>
                <th>Ticket</th>
                <th>Tipo</th>
                <th>Prioridad</th>
                <th>Urgencia</th>
                <th>Sentimiento</th>
                <th>Fecha Creaci√≥n</th>
                <th>Cliente</th>
                <th>Asunto</th>
                <th>Estado</th>
                <th>Canal</th>
                <th>SAC Asignado</th>
                <th>Fecha Cierre</th>
            </tr>
        </thead>
        <tbody>
            {% for ticket in tickets %}
            <tr>
                <td><a href="{{ url_for('ver_ticket', ticket_id_publico=ticket.id_publico) }}">{{ ticket.id_publico }}</a></td>
                <td>{{ ticket.tipo }}</td>
                <td class="prioridad-{{ ticket.prioridad|lower }}">{{ ticket.prioridad }}</td>
                <td class="{% if ticket.urgencia and ticket.urgencia.isdigit() %}urgencia-{{ ticket.urgencia }}{% endif %}">
                    {{ ticket.urgencia }}
                </td>
                <td class="{{ ticket.sentimiento|lower }}">{{ ticket.sentimiento }}</td>
                <td>{{ ticket.fecha_creacion.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>{{ ticket.cliente_nombre }}</td>
                <td>{{ ticket.asunto }}</td>
                <td>{{ ticket.estado }}</td>
                <td>{{ ticket.canal_nombre }}</td>
                <td>{{ ticket.agente_asignado.nombre if ticket.agente_asignado else 'No asignado' }}</td>
                <td>{{ ticket.fecha_cierre.strftime('%Y-%m-%d %H:%M') if ticket.fecha_cierre else 'N/A' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</body>
</html>
